// ═══════════════════════════════════════════════════════
// PRISMA SCHEMA - СХЕМА БАЗЫ ДАННЫХ
// ═══════════════════════════════════════════════════════
// Описание всех таблиц и связей в базе данных
//
// Таблицы:
// - User: пользователи
// - Event: события
// - EventParticipant: участие в событиях (связь многие-ко-многим)
//
// Связи:
// - User → Event (один-ко-многим) - создатель события
// - User → EventParticipant → Event (многие-ко-многим) - участники
// ═══════════════════════════════════════════════════════

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ═══════════════════════════════════════════════════════
// USER - ПОЛЬЗОВАТЕЛЬ
// ═══════════════════════════════════════════════════════
model User {
  id                String             @id @default(uuid())
  email             String             @unique
  username          String             @unique
  password          String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  // Связи
  events            Event[]            @relation("EventCreator")
  participations    EventParticipant[]
  likes             Like[]
  comments          Comment[]
}

// ═══════════════════════════════════════════════════════
// EVENT - СОБЫТИЕ (С ПРИБЛИЗИТЕЛЬНОЙ ГЕОЛОКАЦИЕЙ)
// ═══════════════════════════════════════════════════════
model Event {
  id                String             @id @default(uuid())
  title             String
  description       String?
  
  // Полный адрес (показывается только участникам)
  location          String
  
  // Район (показывается всем)
  locationArea      String
  
  // Координаты с погрешностью (показываются всем)
  latitude          Float
  longitude         Float
  
  // Точные координаты (показываются только участникам)
  exactLatitude     Float
  exactLongitude    Float
  
  dateTime          DateTime
  endDate           DateTime
  category          String
  maxParticipants   Int                @default(10)
  videoUrl          String
  creatorId         String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  // Связи
  creator           User               @relation("EventCreator", fields: [creatorId], references: [id])
  participants      EventParticipant[]
  likes             Like[]
  comments          Comment[]
}

// ═══════════════════════════════════════════════════════
// EVENT PARTICIPANT - УЧАСТНИК СОБЫТИЯ
// ═══════════════════════════════════════════════════════
model EventParticipant {
  id        String   @id @default(uuid())
  eventId   String
  userId    String
  joinedAt  DateTime @default(now())
  
  // Связи
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Уникальное ограничение: один пользователь - одно событие
  @@unique([eventId, userId])
}

// ═══════════════════════════════════════════════════════
// LIKE - ЛАЙК СОБЫТИЯ
// ═══════════════════════════════════════════════════════
model Like {
  id        String   @id @default(uuid())
  eventId   String
  userId    String
  createdAt DateTime @default(now())
  
  // Связи
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Уникальное ограничение: один пользователь - один лайк на событие
  @@unique([eventId, userId])
}

// ═══════════════════════════════════════════════════════
// COMMENT - КОММЕНТАРИЙ К СОБЫТИЮ
// ═══════════════════════════════════════════════════════
model Comment {
  id        String   @id @default(uuid())
  text      String
  eventId   String
  userId    String
  createdAt DateTime @default(now())
  
  // Связи
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}